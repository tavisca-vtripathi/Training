<!DOCTYPE html>
<html>
<head>
<title>4. Templar Widget Development Guide</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
/* GitHub stylesheet for MarkdownPad (http://markdownpad.com) */
/* Author: Nicolas Hery - http://nicolashery.com */
/* Version: b13fe65ca28d2e568c6ed5d7f06581183df8f2ff */
/* Source: https://github.com/nicolahery/markdownpad-github */

/* RESET
=============================================================================*/

html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
}

/* BODY
=============================================================================*/

body {
  font-family: Helvetica, arial, freesans, clean, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  color: #333;
  background-color: #fff;
  padding: 20px;
  max-width: 960px;
  margin: 0 auto;
}

body>*:first-child {
  margin-top: 0 !important;
}

body>*:last-child {
  margin-bottom: 0 !important;
}

/* BLOCKS
=============================================================================*/

p, blockquote, ul, ol, dl, table, pre {
  margin: 15px 0;
}

/* HEADERS
=============================================================================*/

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
}

h1 tt, h1 code, h2 tt, h2 code, h3 tt, h3 code, h4 tt, h4 code, h5 tt, h5 code, h6 tt, h6 code {
  font-size: inherit;
}

h1 {
  font-size: 28px;
  color: #000;
}

h2 {
  font-size: 24px;
  border-bottom: 1px solid #ccc;
  color: #000;
}

h3 {
  font-size: 18px;
}

h4 {
  font-size: 16px;
}

h5 {
  font-size: 14px;
}

h6 {
  color: #777;
  font-size: 14px;
}

body>h2:first-child, body>h1:first-child, body>h1:first-child+h2, body>h3:first-child, body>h4:first-child, body>h5:first-child, body>h6:first-child {
  margin-top: 0;
  padding-top: 0;
}

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0;
}

h1+p, h2+p, h3+p, h4+p, h5+p, h6+p {
  margin-top: 10px;
}

/* LINKS
=============================================================================*/

a {
  color: #4183C4;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* LISTS
=============================================================================*/

ul, ol {
  padding-left: 30px;
}

ul li > :first-child, 
ol li > :first-child, 
ul li ul:first-of-type, 
ol li ol:first-of-type, 
ul li ol:first-of-type, 
ol li ul:first-of-type {
  margin-top: 0px;
}

ul ul, ul ol, ol ol, ol ul {
  margin-bottom: 0;
}

dl {
  padding: 0;
}

dl dt {
  font-size: 14px;
  font-weight: bold;
  font-style: italic;
  padding: 0;
  margin: 15px 0 5px;
}

dl dt:first-child {
  padding: 0;
}

dl dt>:first-child {
  margin-top: 0px;
}

dl dt>:last-child {
  margin-bottom: 0px;
}

dl dd {
  margin: 0 0 15px;
  padding: 0 15px;
}

dl dd>:first-child {
  margin-top: 0px;
}

dl dd>:last-child {
  margin-bottom: 0px;
}

/* CODE
=============================================================================*/

pre, code, tt {
  font-size: 12px;
  font-family: Consolas, "Liberation Mono", Courier, monospace;
}

code, tt {
  margin: 0 0px;
  padding: 0px 0px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px;
}

pre>code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent;
}

pre {
  background-color: #f8f8f8;
  border: 1px solid #ccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px;
}

pre code, pre tt {
  background-color: transparent;
  border: none;
}

kbd {
    -moz-border-bottom-colors: none;
    -moz-border-left-colors: none;
    -moz-border-right-colors: none;
    -moz-border-top-colors: none;
    background-color: #DDDDDD;
    background-image: linear-gradient(#F1F1F1, #DDDDDD);
    background-repeat: repeat-x;
    border-color: #DDDDDD #CCCCCC #CCCCCC #DDDDDD;
    border-image: none;
    border-radius: 2px 2px 2px 2px;
    border-style: solid;
    border-width: 1px;
    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    line-height: 10px;
    padding: 1px 4px;
}

/* QUOTES
=============================================================================*/

blockquote {
  border-left: 4px solid #DDD;
  padding: 0 15px;
  color: #777;
}

blockquote>:first-child {
  margin-top: 0px;
}

blockquote>:last-child {
  margin-bottom: 0px;
}

/* HORIZONTAL RULES
=============================================================================*/

hr {
  clear: both;
  margin: 15px 0;
  height: 0px;
  overflow: hidden;
  border: none;
  background: transparent;
  border-bottom: 4px solid #ddd;
  padding: 0;
}

/* TABLES
=============================================================================*/

table th {
  font-weight: bold;
}

table th, table td {
  border: 1px solid #ccc;
  padding: 6px 13px;
}

table tr {
  border-top: 1px solid #ccc;
  background-color: #fff;
}

table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

/* IMAGES
=============================================================================*/

img {
  max-width: 100%
}
</style>
</head>
<body>
<h1>Templar Widget Development Guide</h1>
<hr />
<p><strong>If you have comments /queries about this documentation, email them to:</strong></p>
<p><strong><a href="&#109;&#x61;&#105;&#108;&#116;&#x6f;&#x3a;&#116;&#x65;&#109;&#x70;&#108;&#97;&#114;&#64;t&#97;&#x76;&#x69;&#x73;&#99;&#x61;.&#x63;&#111;&#109;">&#x74;&#x65;&#109;&#x70;&#108;a&#x72;&#x40;&#x74;&#97;&#118;&#105;&#115;&#x63;&#97;&#46;&#99;&#111;&#109;</a></strong></p>
<hr />
<h2>Table of Contents</h2>
<pre><code>1.  Assumptions
2.  Introduction
3.  Project Setup
4.  Simple widget
5.  Widget with settings
6.  Widget Registration
7.  Deploying a widget
</code></pre>

<h1>Templar v1.7 - Widget Development Guide</h1>
<h2>Assumptions</h2>
<p>This document is meant for developers and assumes you have read Templar overview document.</p>
<p>It also assumes you have basic knowledge of ASP.NET and can write a simple user control. If not that please familiarize yourself with that first before proceeding.</p>
<h2>Introduction</h2>
<p>Widgets as you know are the building blocks of Templar. Widgets are what enable users to create rich interfaces with minimum effort. A well designed widget will enable you to reuse it across different scenarios. Any application functionality can be implemented as a widget or a set of widgets.</p>
<p>In this document we cover full widget development life-cycle from</p>
<ul>
<li>
<p>Setting up the project for development</p>
</li>
<li>
<p>Creating a simple widget</p>
</li>
<li>
<p>Creating a widget with settings</p>
</li>
<li>
<p>Registering and using the widget</p>
</li>
<li>
<p>Deploying your widget</p>
</li>
</ul>
<p>Templar is built on top of ASP.NET 4.5. The primary language used in C# however you can use any managed language to write your widget code.</p>
<h2>Project Setup</h2>
<p>To create widgets for Templar you need VS2012 and a Templar development project setup.</p>
<p>Just unzip the setup project and you will have the structure ready as shown below.</p>
<p><img src="./images/4.TemplarWidgetDevelopmentGuide/image_0.png" /></p>
<p>Things to note here </p>
<p><strong>1. Portal –</strong> it is the main Templar application project</p>
<p><strong>2. Sample Widgets –</strong> this is the project added for new widget creation. It can be a class library or web application project as per your choice. You can create multiple widgets in this project however it is advisable to group widgets into separate projects based on functionality. </p>
<p><strong>3. Widgets folder –</strong> your widget project should have a folder named Widgets inside which you should create your widgets. As a best practice you should create a folder for each widget inside the root Widgets folder.</p>
<p><strong>4. Templar contract –</strong> to access Templar interfaces add a reference to &quot;Tavisca.Templar.Contract&quot; in your project. Also add a reference of your project to the main Portal project to avoid manually copying any dependencies.</p>
<p><strong>5. Post build task –</strong> since your widget markup should be finally copied to the Portal project’s Widget folder so as a convenience you can setup a post build task for copying your Widgets folder to the Portal’s root folder.</p>
<p>Post build event sample command is </p>
<pre><code>xcopy &quot;$(ProjectDir)Widgets&quot; &quot;$(SolutionDir)Portal\Widgets&quot; /r /i /d /y /s
</code></pre>

<h2>Simple widget</h2>
<p>Let’s create a simple &quot;Hello World&quot; widget which displays “Hello world” on the page where it is added.</p>
<ol>
<li>
<p>To start with we will add a folder called HelloWorldWidget inside the Widgets folder of our project and then add a user control. Giving it the name HelloWorldWidget.ascx.</p>
</li>
<li>
<p>To make it a widget, this user control needs to implement Templar’s IWidget interface.</p>
<p>IWidget interface defines the methods as shown below</p>
<p><img src="./images/4.TemplarWidgetDevelopmentGuide/image_1.png" /></p>
<ul>
<li>
<p><strong>Init –</strong> When a widget is initialized by Templar this is the first method which is called.
		This method provides an IWidgetHost object to the widget, which is the key for all widget interactions with Templar and in the context the site, page and other widgets.<br />
		The instance of this IWidgetHost object should be stored locally for later use.</p>
</li>
<li>
<p><strong>ShowSettings-</strong> This method is called when a user clicks on settings icon of the widget in Templar 							designer.Once called this method should show all setting options which you as a widget 						developer want the user to configure for each instance of your widget.</p>
</li>
<li>
<p><strong>HideSettings-</strong> This method is called when a user clicks on settings icon of a widget with open settings in Templar designer. Once called you should close your settings display.</p>
</li>
</ul>
<p>For this widget we will keep the interface implementation empty. We will come back to it later.</p>
</li>
<li>
<p>Add a label to the HelloWorldWidget.ascx page and write &quot;Hello world&quot;</p>
</li>
<li>
<p>That’s all compile and the widget is ready.</p>
<p><strong>Markup</strong></p>
<p><img src="./images/4.TemplarWidgetDevelopmentGuide/image_2.png" /></p>
<p><strong>Code</strong></p>
<p><img src="./images/4.TemplarWidgetDevelopmentGuide/image_3.png" /></p>
</li>
<li>
<p>Next you register this widget (Refer widget registration section) and use it in your pages.</p>
</li>
</ol>
<h2>Widget with settings</h2>
<p>The simple &quot;Hello world&quot; widget doesn’t do much except display the static “Hello world” text. </p>
<p>To really create reusable widgets you need to allow your users to customize your widget.</p>
<p>Let’s say now we want to give users the ability to configure the name &quot;world&quot; to one of their choosing.</p>
<p>To achieve we need to drill a bit deeper into IWidgetHost which we ignored earlier.</p>
<p>As we know IWidgetHost is the key for all widget interactions with the system. It also proved a basic data store for widget and we will use this to store our settings.</p>
<p>IWidgetHost interface defines the methods as shown below</p>
<p><img src="./images/4.TemplarWidgetDevelopmentGuide/image_4.png" /></p>
<p>There are a lot of capabilities provided by IWidgetHost. Here we are only interested in the SaveState and GetState methods. One takes a string and saves it and the other returns the saved string. This state is saved for each widget instance so if you have added the same widget on the page three times then each would have different state for their use.</p>
<p>What we will do is create a settings panel in the widget and give user the option to set his display message there. </p>
<p>We will hook up this section with the yet unused HideSettings and ShowSettings methods of IWidget interface we implemented earlier.</p>
<p>Once the user adds the message we will save it in state. On initialize we will check if there is some state saved, if there is than we will use that for name else we will use the default &quot;world&quot;.</p>
<ol>
<li>
<p>After changes the widget settings section looks like</p>
<p><img src="./images/4.TemplarWidgetDevelopmentGuide/image_5.png" /></p>
<p>Few things to note here</p>
<ul>
<li>
<p>We have now added two panels for grouping settings and main widget code. </p>
</li>
<li>
<p>By default the settings panel is set to visible=&quot;false” so it is not rendered in normal flow</p>
</li>
<li>
<p>We have hooked the settings save function to btnSave_click where we save the settings.</p>
</li>
</ul>
</li>
<li>
<p>The code for the widget now looks like!</p>
<p><img src="./images/4.TemplarWidgetDevelopmentGuide/image_6.png" /></p>
<p>Few things to note her</p>
<ul>
<li>
<p>We have cached the host using a property named Host</p>
</li>
<li>
<p>Post saving the state we have called Host.HideSettings in btnSave_Click. This will close the settings panel and displayed the updated widget panel</p>
</li>
<li>
<p>We have added ASP.NET’s Page_PreRender method to render latest widget data</p>
</li>
</ul>
</li>
<li>
<p>That’s all compile and register this widget (Refer widget registration section)</p>
</li>
<li>
<p>Now let’s use this on a page </p>
<ul>
<li>
<p>Create a page and add the widget to the page from top widget panel</p>
</li>
<li>
<p>Click on widget settings icon as shown</p>
</li>
</ul>
<p><img src="./images/4.TemplarWidgetDevelopmentGuide/image_7.png" /></p>
<ul>
<li>Write a new name in settings section e.g. John</li>
</ul>
<p><img src="./images/4.TemplarWidgetDevelopmentGuide/image_8.png" /></p>
<ul>
<li>Save and the widget will now show your changed message!</li>
</ul>
<p><img src="./images/4.TemplarWidgetDevelopmentGuide/image_9.png" /></p>
<ul>
<li>Click the current view of this page to see how it will look to end users after publishing. The current view removes the layout and designer additions from your widget.</li>
</ul>
</li>
</ol>
<h2>Widget Registration</h2>
<p>A widget has to be register before it can be used.</p>
<p>Follow the steps below for registering a new widget.</p>
<ol>
<li>
<p>Login to Templar </p>
</li>
<li>
<p>Go to Admin tab click widgets tab</p>
</li>
<li>
<p>Click 'Add new widget' link on top</p>
</li>
<li>
<p>Enter details e.g. </p>
<ul>
<li>
<p>Widget name: HelloWorldWidget</p>
</li>
<li>
<p>Widget url: HelloWorldWidget\HelloWorldWidget.ascx (This is the very important, it is the relative url for the widget from widgets folder)</p>
</li>
<li>
<p>Description, icon, state are optional</p>
</li>
</ul>
<p><img src="./images/4.TemplarWidgetDevelopmentGuide/image_10.png" /></p>
</li>
<li>
<p>If all went well you should be able to see the widget by clicking the preview icon</p>
<p><img src="./images/4.TemplarWidgetDevelopmentGuide/image_11.png" /></p>
</li>
<li>
<p>In case of any issues with the widget, preview will throw an error.
You can go to Reports&gt;Unhandled Exception report and check for errors.
Fix them and try again and you should be able to see the preview.</p>
</li>
<li>
<p>Now if you create a new page. Then after clicking the designer’s widget tab you should be able to see your new 	widget. You can use it be dragging and dropping it to your page.</p>
<p><img src="./images/4.TemplarWidgetDevelopmentGuide/image_12.png" /></p>
</li>
</ol>
<h2>Deploying a widget</h2>
<p>Once you have tested your widget locally you need to deploy it to the Templar environment where users can start using it. A widget as we have already seen is an ASP.NET user control, for it to run we need to </p>
<ul>
<li>
<p>Copy the markup of the control .ascx file with all associated scripts or media files and to a folder under Widgets of the main Templar deployment</p>
</li>
<li>
<p>Next we need to copy the widget’s dll and any dependent dlls to main Templar installation’s Bin folder</p>
</li>
</ul>
<p>(In case of multi machine deployment you need to do this on each server individually).</p>
<p>Once copied, register the widget on this environment and then you can start using the widget.
l
If you used a Web Application project for creating the widget than you can simply publish the project to get the required filed for deployment.</p>
<hr />

</body>
</html>
<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->
